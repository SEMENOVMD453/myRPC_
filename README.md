# myRPC клиент-серверное приложение

---

Данный проект включает сервер `myRPC-server`, клиентское приложение `myRPC-client`, библиотеку логирования `mysyslog` и вспомогательные Bash-скрипты. Также реализована сборка `.deb` пакетов и формирование локального APT-репозитория. Клиент подключается к этому репозиторию, устанавливает необходимые пакеты и взаимодействует с сервером.

### Клиент myRPC-client

Клиент позволяет пользователю через аргументы командной строки задать IP-адрес, тип сокета и команду для отправки серверу. Программа выводит справку и сообщения об ошибках при невозможности установить соединение.

### Сервер myRPC-server

Сервер читает настройки из конфигурационного файла `/etc/myRPC/myRPC.conf` (порт и тип сокета), принимает команды через сокеты, извлекает имя пользователя и команду, сверяет пользователя по списку в `/etc/myRPC/users.conf`, а затем логирует результат через `mysyslog` в каталог `/tmp/`.

### Библиотека mysyslog

Отвечает за логирование событий и операций:
- в /var/log/myrpc.log
- в формате [2025-05-28 09:45:26] [INFO] Получено от UDP-клиента: { "login": "user", "command": "echo Hello World!" }

---

## Настройки

Проект поддерживает конфигурацию через следующие файлы: `myRPC.conf`, `users.conf`, а также unit-файл systemd `myRPC-server.service`.

### myRPC.conf

```
port = <укажите порт>
socket_type = <stream (TCP) | dgram (UDP)>
```

Если конфигурация не задана — сервер будет использовать порт `25565` и тип сокета `stream` по умолчанию.

Пример копирования настроек в системный каталог:

```bash
cp -f ./src/config/myRPC.conf /etc/myRPC/
```

Если папка не существует, создайте её:

```bash
mkdir -p /etc/myRPC
```

### users.conf

Формат:

```
user1
user2
user3
```

Если пользователя нет в этом списке — сервер отклонит запрос и вернёт JSON-ошибку.

Файл размещается аналогично `myRPC.conf`.

---

## clean.sh

При выполнении `make clean` удаляются временные лог-файлы с шаблоном `myRPC_XXXXXX` в `/tmp/`.

---

## Требования

- `gcc` — компилятор C
- `python3` — запуск локального сервера
- `git` — клонирование репозитория
- `make` — сборка проекта
- `fakeroot` — генерация `.deb` пакетов

---

## Сборка проекта

Сборка осуществляется через `Makefile`.

1. Клонировать проект:
```bash
git clone <ссылка на репозиторий>
```

2. Перейти в каталог проекта:
```bash
cd ~/myRPC/
```

3. Собрать бинарники:
```bash
make all
```

4. Создать `.deb` пакеты:
```bash
make deb
```

5. Сформировать локальный репозиторий:
```bash
make repo
```

6. Собрать полный репозиторий с зависимостями:
```bash
make repository
```

---

## Сетевой репозиторий

APT-репозиторий позволяет подключаться по локальной сети и устанавливать `.deb` пакеты на клиентской машине.

1. Перейти в каталог с репозиторием:
```bash
cd repo
```

2. Запустить HTTP-сервер:
```bash
python3 -m http.server <порт>
```

3. На клиенте добавить источник:
```bash
echo "deb [trusted=yes] http://<IP-сервера>:<порт>/ ./" | sudo tee /etc/apt/sources.list.d/myrpc.list
```

4. Обновить индексы и установить:
```bash
sudo apt update
sudo apt install myRPC-client myRPC-server mysyslog
```

Файл `Packages.gz` также можно скачать по адресу:  
http://localhost:8000/Packages.gz

---

## Запуск проекта

### myRPC-server

Сервис запускается автоматически после установки из `.deb`. Если нет — запустите вручную:

Статус:
```bash
systemctl status myRPC-server
```

Перезагрузка systemd:
```bash
systemctl daemon-reload
```

Перезапуск сервера:
```bash
systemctl restart myRPC-server
```

При изменении `myRPC.conf` или `users.conf` обязательно выполните перезапуск сервиса:
```bash
systemctl restart myRPC-server
```

---

### myRPC-client

Запускается напрямую из `bin/` или как установленное приложение.

Пример использования:
```bash
./bin/myRPC-client <параметры>
```

Аргументы:
- `-c` — команда
- `-h` — адрес сервера
- `-p` — порт (должен соответствовать `myRPC.conf`)
- `-d` — использовать UDP
- `-s` — использовать TCP

Пример запроса:
```bash
myRPC-client -c "echo Привет сервер" -h 127.0.0.1 -p 4040 -d
```

Если пользователь не авторизован, сервер вернёт ошибку с кодом 1. В случае успеха — клиент получит ответ от сервера.

---
